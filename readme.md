# J-chat 角色扮演聊天助手 🤖

    是一个基于 SpringAi 的智能角色扮演聊天助手，让用户能够与历史名人、虚拟角色进行沉浸式对话交流。

体验地址：https://jchat.kimwonjoon.top/

## 1. 目标用户分析
### 1.1 主要用户群体
    主要是面向一些有知识问答学习需求需求的个人用户。这里主要包含高等教育学生、终身学习者以及芝士爱好者、创意写作者及角色扮演游戏爱好者等等。
### 1.2 用户主要面临痛点
    传统教科书和单向授课方式缺乏互动性和趣味性，并且在课堂上无法获得一对一、按自己节奏进行的辅导。 
    然后每个人对一个话题产生兴趣时，都希望立刻能与相关"专家"探讨。 
    对于一些创意写作者想练习对话写作或构建角色时，找不到合适的"对手演员"。 
    现在 J-chat 可以满足这些需求。
- 对苏格拉底的"诘问法"感到困惑的你。打开了J-chat，搜索并选择"苏格拉底"角色。通过语音问道："苏格拉底先生，什么是正义？" 苏格拉底并没有直接回答，而是通过一系列反问引导你自己思考。 在一来一往的对话中，你不仅理解了概念，更体验了哲学思辨的乐趣，记忆深刻。 
- 想写一个与爱因斯坦讨论相对论的情节的你。他选择"爱因斯坦"角色，用中文（或德文/英文）提问："教授，如果我能以光速旅行，我会看到什么？" 爱因斯坦角色用通俗易懂又充满智慧的语言解释时空弯曲，为你的创作提供了极佳的灵感和素材。
## 2.功能需求分析
### 2.1 核心功能
    ✅1、文本聊天界面： 最基础的与AI角色交互的方式。
    ✅2、语音聊天（双向）：
        - 语音转文本： 将用户的语音实时转换为文字，发送给LLM。
        - 文本转语音： 将LLM返回的文字回复，用符合角色特征的语音朗读出来。
    ✅3、基础角色设定： 为每个角色配置基础的系统提示词，定义其性格、知识和说话风格。 
### 2.2 重要功能
    ✅1、对话历史记录： 允许用户保存和回顾之前的对话。
    ✅2、多语言支持： 用户可以选择与角色用哪种语言交流（例如，用中文问爱因斯坦，或用英文问哈利·波特）。
    3、角色发现与推荐： 根据用户兴趣推荐相关角色。
    4、语音自定义： 为角色提供多种音色选择。
    ✅（完成一半）5、知识库上传： 允许用户为特定角色上传额外的背景资料，让角色知识更精准。
### 2.3 MVP
    专注于实现核心功能，打造一个可用的最小化可行产品。（上面有 ✅ 的为已实现功能）
## 3. 模型选择
### 3.1 LLM
**Doubao 1.5 pro-32K**

    在多项公开测评基准上达到全球领先水平，特别在知识、代码、推理、中文权威测评基准上获得最佳成绩，综合得分优于GPT4o、Claude 3.5 Sonnet等业界一流模型。 
    角色扮演专项升级：支持真人向聊天风格，能精准还原角色人设并推动对话连贯性。

**其他**
    
    可以进行动态配置，支持 OpenAI API 兼容模型。
### 3.2 语音模型（ASR&TTS）
**ASR-qwen3-asr-flash**

    通义千问3-ASR-Flash是一款基于大语言模型的高精度、高智能、高鲁棒性的多语种语音识别模型。 
    依托强大的基座模型、海量的文本与多模态数据、千万小时音频数据，通义千问3-ASR-Flash实现了高精度的语音识别功能，能够自动判断语种并准确识别11个语种的语音，在复杂的音频环境下能够保证精确转录。
**cosyvoice-v2**
    
    cosyvoice-V2是通义实验室依托大规模预训练语言模型，在深度融合文本理解和语音生成的新一代生成式语音合成大模型。
    主要是支持文本至语音的实时流式合成。可以快速生成高质量的语音。

## 4.整体流程
    整个系统流程大概如下：
    ---------------------------------------------------------------------------------------------------

        前端录音 → Base64编码 → WebSocket传输 →后端解码 → 阿里云ASR → 文本处理 →AI生成回复 → TTS合成 → 音频返回

    ---------------------------------------------------------------------------------------------------
    其中 LLM 到 TTS 处理到 输出采用流式处理的方式。并且整个前端到后端采用websocket进行实时推送。
- 流式调用TTS（原本采用同步调用的方式，但是速度过慢，用户体验不佳，改为采用流式调用的方式）

<img src="/docs/img/TTS.png" width="800"> 

## 5.技术栈
### 🏗️ 后端技术栈 核心框架
- Spring Boot 3.4.3 - 主应用框架
- Spring AI 1.0.0 - AI集成框架，支持多种LLM模型
- Spring WebSocket - 实时通信支持
- PgVector - 向量数据库，支持RAG检索 数据存储
- MySQL 8.0+ - 主数据库（用户、角色、模型配置）
- Redis (Redisson) - 缓存和会话存储
- 阿里云OSS - 存储用户语音服务
- 阿里云语音服务 - TTS/ASR能力
- WebSearch MCP - 联网搜索能力
### 🎨 前端技术栈 基础技术（由 AI 提供）
- HTML5 - 页面结构
- CSS3 - 样式设计（响应式布局）
- Vanilla JavaScript - 原生JS，无框架依赖
- WebSocket (STOMP) - 实时通信协议
### 🚀 技术特色 
**1. 多模型支持架构**
- 策略模式 - 动态模型切换
- 工厂模式 - 模型实例创建
- 适配器模式 - 不同AI服务集成

**2. 实时通信架构**
- WebSocket + STOMP - 双向实时通信
- 消息队列 - 异步消息处理
- 流式响应 - 实时AI回复

## 6.未来迭代计划
### 沉浸式互动技能
**情景模拟与角色带入**
        
    AI角色能记住并融入设定的情景，保持对话的连贯性和戏剧感。 
    用户可以设定情景为"霍格沃茨图书馆"，赫敏角色会压低声音说话，并提醒你平斯夫人正在盯着我们。 
    或者与诸葛亮进行"隆中对"，他会在地图上为你指点江山。极大提升沉浸感，让学习像一场冒险。
**知识管理与创造技能**
        
    在对话结束后，AI角色能自动生成一份总结报告，提炼核心知识点、关键问答，甚至生成一个简单的思维导图。存入知识库，方便下次使用。
    帮助用户巩固知识，将散乱的对话结构化，便于复习。

---

## 7. 运行指南

### 7.1 环境准备

#### 基础环境
- **JDK 17+** - Java开发环境
- **Maven 3.6+** - 项目构建工具
- **MySQL 8.0+** - 主数据库
- **PostgreSQL 12+** - 向量数据库（需安装 pgvector 扩展）
- **Redis 6.0+** - 缓存数据库

#### 外部服务配置
- **OpenAI API** - LLM服务（或兼容的代理服务）
- **阿里云账号** - 语音服务（ASR/TTS）和OSS存储
- **豆包API** - 可选的LLM服务

### 7.2 快速开始

#### 1. 克隆项目
```bash
git clone https://github.com/Wonjoon0129/Jchat.git
cd Jchat
```

#### 2. 数据库初始化
```sql
-- MySQL 数据库
CREATE DATABASE jchat CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
-- 导入表结构
mysql -u root -p jchat < docs/dev-ops/mysql/sql/j-chat.sql

-- PostgreSQL 数据库（用于向量存储）
CREATE DATABASE jchat_vector;
-- 安装 pgvector 扩展
CREATE EXTENSION vector;
```

#### 3. 配置文件修改
编辑 `Jchat-app/src/main/resources/application-dev.yml`：

```yaml
# 数据库配置
spring:
  datasource:
    url: jdbc:mysql://localhost:3306/jchat
    username: your_mysql_username
    password: your_mysql_password
  
  # PostgreSQL 向量数据库
  ai:
    vectorstore:
      pgvector:
        url: jdbc:postgresql://localhost:5432/jchat_vector
        username: your_pg_username
        password: your_pg_password

# AI 服务配置
dashscope:
  api-key: your_dashscope_api_key
  
openai:
  api-key: your_openai_api_key
  base-url: your_openai_base_url
```

#### 4. 编译运行

**方式一：Maven 运行**
```bash
mvn clean compile
mvn spring-boot:run -pl Jchat-app
```

**方式二：JAR 包运行**
```bash
mvn clean package
java -jar Jchat-app/target/Jchat-app-1.0-SNAPSHOT.jar
```

**方式三：IDE 运行**
- 导入项目到 IntelliJ IDEA
- 运行 `com.kim.Application` 主类



    

    


